name: $(semanticVersion)-build$(rev:rrr)

trigger:
  - master

pool: default

variables:
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'

stages:
  - stage: 'BuildSandbox'
    displayName: 'Build the sandbox projects'
    jobs: 
      - job: 'Build'
        variables:
          solution: 'src/Sandbox.sln'
        
        steps:
          - task: NuGetToolInstaller@1

          - task: CmdLine@2
            inputs:
              script: |
                echo  'Default Working Directory: $(System.DefaultWorkingDirectory)'
                echo  'Pipeline Workspace: $(Pipeline.Workspace)'
                dir
            displayName: Show working directory

          - task: NuGetCommand@2
            inputs:
              restoreSolution: '$(solution)'

          - task: VSBuild@1
            inputs:
              solution: '$(solution)'
              platform: '$(buildPlatform)'
              configuration: '$(buildConfiguration)'

          - task: VSTest@3
            inputs:
              platform: '$(buildPlatform)'
              configuration: '$(buildConfiguration)'
              codeCoverageEnabled: false
              diagnosticsEnabled: false

  - template: ci/build-demo.yml
    parameters:
      stageName: BuildAws
      solution: demo/Aws/Aws.sln

  - template: ci/build-demo.yml
    parameters:
      stageName: BuildAzure
      solution: demo/Azure/Azure.sln

  - template: ci/build-demo.yml
    parameters:
      stageName: BuildDesktop
      solution: demo/Desktop/Desktop.sln
